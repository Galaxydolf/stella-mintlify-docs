---
title: "初級編：ナレッジベースエージェント"
---

ナレッジベース型のエージェントは、現在人気の高いエージェントタイプのひとつです。

個人や企業が保有する**独自のデータ**を大規模言語モデルと連携させることで、モデルの知識範囲を拡張し、より業務に密着した高度な応答が可能になります。

エージェントの設定画面で「ナレッジベースとの連携」を有効にすると、フロービルダー（キャンバス）上に「ナレッジベース検索」モジュールが自動的に追加されます。

&#x20;今回の例では、このナレッジベース検索モジュールの機能設計について詳しく解説します。

### 基本構成

今回構築するのは「大規模言語モデルに関する質問に答えるAIアシスタント」です。&#x20;

事前に大規模言語モデルに関する資料をナレッジベースにアップロードしておき、 その情報をもとに、ユーザーからの質問に専門的に回答できるエージェントを構成します。

![](https://uxkpl4cba3j.feishu.cn/space/api/box/stream/download/asynccode/?code=YjU5NmEwMTY0MTM3NzkxZDlmODliMGYxMDlmY2RlYmJfOWx6cW5MQlk0U25TMFRHVjNoUTJmUFROMFcxVkdNS3NfVG9rZW46WTN3cmJLRmpibzU5U3J4bjJlZWM0ZmhSbnZoXzE3NDMwNDQxMjI6MTc0MzA0NzcyMl9WNA)

### フロービルダーでの構成

エージェントの設定ページで「ナレッジベース」を関連付けると、キャンバス画面に「ナレッジベース検索」モジュールが自動で追加されます。

このモジュールは、アップロードされた資料を活用してAIが質問に回答するための設計です。具体的なフローは以下の通りです：

#### モジュール接続の流れ

* **ユーザー入力の取得**：「ユーザー入力」モジュールで、ユーザーからの入力を受け取り、情報を出力。

* **ナレッジベース検索モジュールの動き：**
  &#x20;　「情報入力」欄にユーザー入力が渡されると、以下のステップが実行されます：

  * ユーザー入力を数値化（ベクトル化）し、 ナレッジベース（今回の例では大規模言語モデル関連資料）内の既存データと照合。

  * 類似度に基づいてスコア付けされ、最も関連性の高いコンテンツが上位に表示されます。

* **検索結果による分岐処理**

  このモジュールには3つの出力があり、それぞれ以下のようなフローを構成します：

  * **ルート1：検索結果なし：** 検索結果に一致する資料が**なかった場合**、　「返信確定」モジュールが実行され、以下のようなメッセージが返信されます：
    &#x20;　「申し訳ありません、この質問にはまだ対応できません。さらなる学習が必要です。」といった定型文をユーザーへ返します。

  #### ルート2：検索結果あり

  * 関連する情報が見つかった場合、以下3つの情報を「AI応答」モジュールへ送信します：
    &#x20;　　- プロンプト（エージェントのガイドメッセージ）
    &#x20;　　- ナレッジベース検索結果
    &#x20;　　- ユーザーからの入力内容

  * モデルはこれらをもとに、最適な回答を生成し、ユーザーに返答します。

* 「「AI応答」モジュールは、上記の3つの入力情報を受け取った後、以下の処理を実行します：

  * **プロンプト**、**ユーザーの入力内容**、および**ナレッジベースの検索結果**を、天工大模型（Tiangong LLM）に送信します。

  * 天工大模型は、これらの情報を元に最適な回答を生成し、ユーザーに返答します。

![](https://uxkpl4cba3j.feishu.cn/space/api/box/stream/download/asynccode/?code=NTM0ZGM5NmVkMDhjM2QyZTg2N2RkYTFlM2MxMGYzMmJfOTdwS1dPVndRc2xLeXdiMkJYU2k1SjBsWUp4cnhnT3JfVG9rZW46U3JBbmJUN0Mzb0VkNkd4VWJJcWNGcjJ1bmxkXzE3NDMwNDQxMjI6MTc0MzA0NzcyMl9WNA)

「ナレッジベース検索」モジュールでは、**「ナレッジベース類似度」と「検索件数の上限」という2つの重要なパラメータが用意されています。**
**これらのパラメータは、ベクトル検索によるマッチング結果の件数および最終的に返される検索結果の件数**に影響します。
利用シーンやナレッジ内容に応じて適切に調整することで、より正確で有効な応答が得られます。



**ナレッジベース類似度**

* ユーザーの質問とナレッジベース内の情報スライス（テキスト片）との**類似度の下限値を設定します。**

* この数値が高いほど、より精度の高いマッチングが行われますが、結果件数は少なくなる傾向があります。

* 類似度スコアが低いと、関連性の薄い結果も返されやすくなるため、内容に応じてバランス調整が重要です。

* 推奨設定値：0.6 ～ 0.9 の範囲内

**単回検索上限（最大ヒット数）**

* 検索時に最大で何件の結果を返すかを制限します（例：最大5件など）。

* 件数を多くすると幅広く情報を得られる一方で、モデルの最大トークン数制限や各テキスト片のサイズにより、 情報の切り捨てや処理負荷が発生する可能性があります。

* 数値はケースに応じてテストしながら最適値を見つけるのがおすすめです。

> ※「多ければ多いほど良い」というわけではない点にご注意ください。品質と処理効率のバランスが重要です。



![](https://uxkpl4cba3j.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjQwODk1MzZkM2E4Yzg2MjBlZGYwOTE5ODYzMzMzM2Jfbkw0a1BqTFhzRHAzWDc3bWJqSmZMSzBzd012M3BuaXlfVG9rZW46UjExR2JFQTZXbzI3Q2N4NWZteGN2NFJxbmFmXzE3NDMwNDQxMjI6MTc0MzA0NzcyMl9WNA)

